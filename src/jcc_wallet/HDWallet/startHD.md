---
# title: remote
# editLink: true
checkCode: '点我运行代码'
outline: deep
---
# 什么是HD Wallet？

&emsp;&emsp;HD Wallet是分层确定性（Hierarchical Deterministic）钱包的简写。在HD Wallet出现之前，用户如果想要拥有多个钱包则需要通过随机数生成互不相关的多个私钥。这种类型的钱包被称作非确定钱包（或随机钱包）。但是这种方式会导致用户备份账号时容易发生丢失，记忆错误等情况。

&emsp;&emsp;为了解决非确定性钱包的私钥管理问题，有人提出根据一个随机数种子通过分层确定性推导的方式得到n个私钥，这样保存的时候，只需要保存一个种子就可以，私钥可以推导出来(`BIP32`)。并在这种思想的基础上又分别有人提出助记词（`BIP39`）、派生路径规范（`BIP44`）等提案，形成了现在统一规范的HD wallet。

## BIP32

![bip32](../../asset/bip32.svg)
&emsp;&emsp;BIP32是一种分层确定性钱包（Hierarchical Deterministic Wallets）的标准，它可以让用户从一个单一的种子（seed）生成一系列的密钥对（公钥和私钥），并按照一定的层级结构进行组织和管理。这样可以避免用户需要备份和记忆大量的密钥，也可以方便地恢复和迁移钱包。

&emsp;&emsp;BIP32的核心思想是使用一个扩展私钥（extended private key）和一个扩展公钥（extended public key）来推导出无限多个子密钥对。扩展私钥由一个256位的私钥和一个256位的链码（chain code）组成，扩展公钥由一个256位的公钥和一个256位的链码组成。链码是用于增加密钥推导过程中的熵（entropy）的随机数，可以提高密钥的安全性。

&emsp;&emsp;BIP32使用两种方式来推导子密钥对，分别是硬化推导（hardened derivation）和非硬化推导（non-hardened derivation）。硬化推导只使用扩展私钥来生成子扩展私钥，而非硬化推导可以使用扩展公钥来生成子扩展公钥。这样可以实现不同的用途，比如硬化推导可以用于保护主密钥不被暴露，而非硬化推导可以用于生成只读的子账户。

## BIP39

![bip39](../../asset/bip39.svg)
&emsp;&emsp;BIP39是一种助记词（mnemonic）的标准，它可以让用户使用一组易于记忆和书写的单词来代替复杂的种子或者密钥。这样可以避免用户因为输入错误或者遗忘而导致资产丢失，也可以方便地备份和恢复钱包。

&emsp;&emsp;BIP39的核心思想是使用一个固定的2048个单词的列表来生成助记词，并使用一个可选的密码短语（passphrase）来增加安全性。助记词和密码短语通过一个哈希函数（PBKDF2）来生成一个512位的种子，然后再通过另一个哈希函数（HMAC-SHA512）来生成一个扩展私钥和一个链码，作为BIP32或者BIP44的输入。

&emsp;&emsp;BIP39支持不同长度的助记词，分别是12、15、18、21和24个单词。每个单词都有11位的二进制编码，最后还有一位校验位（checksum）。校验位是通过对所有单词的二进制编码进行SHA256哈希运算得到的。校验位的长度取决于助记词的长度，比如12个单词对应1位校验位，24个单词对应8位校验位。校验位可以防止用户在输入助记词时出现拼写错误或者顺序错误。

&emsp;&emsp;BIP39还支持不同语言的助记词列表，目前有英语、中文、法语、意大利语、日语、韩语、西班牙语等。但是建议用户使用英语列表，因为它是最广泛支持和兼容的。

## BIP44

![bip44](../../asset/bip44.svg)
&emsp;&emsp;BIP44的核心思想是定义了一个固定的五级路径结构来组织和标识不同的子密钥对，使用斜杠（/）来分隔不同的层级。比如m/44’/0’/0’/0/0表示从主扩展私钥m开始，经过硬化推导得到第44个子扩展私钥，再经过硬化推导得到第0个子扩展私钥，再经过非硬化推导得到第0个子扩展公钥，再经过非硬化推导得到第0个子扩展公钥，再经过非硬化推导得到第0个子密钥对。每个层级都有一个索引号（index），从0开始计数，如果是硬化推导，则在索引号前加上撇号（'），表示加上了一个常数2^31。

BIP44为这个路径约定了一个规范的含义(m是固定的, purpose也是固定的)：

`m / purpose' / coin' / account' / change / address_index`

BIP44的五级路径结构分别代表了以下含义：

- 第一层：用于表示不同的用途(purpose)，目前固定为44，表示遵循BIP44标准。
- 第二层：用于表示不同的币种类型(coin type)，使用一个数字来标识，比如0表示比特币，1表示莱特币，60表示以太坊等。
  
   完整的币种列表地址：<https://github.com/satoshilabs/slips/blob/master/slip-0044.md>
- 第三层：用于表示不同的账户(account)，代表这个币的账户索引，从0开始。每个账户可以有自己的余额和地址。用户可以根据自己的需要创建多个账户，比如用于区分个人和商业用途等。
- 第四层：用于表示不同的地址类型(change)，目前有两种类型，分别是0表示外部地址(external address)，1表示内部地址(internal address)。外部地址是用于接收转入的资金，内部地址是用于找零或者转移资金等。
- 第五层：这就是地址索引(address_index)，从0开始，代表生成第几个地址，官方建议，每个account下的address_index不要超过20。

<!-- ## 创建HDWallet流程

1.先生成一个128位随机数熵(Entropy)，再加上对随机数做的校验4位，得到132位的一个数，然后按每11位做切分，这样就有了12个二进制数，然后用每个数去查BIP39定义的单词表，这样就得到12个助记词。

2.使用密钥拉伸（Key stretching）函数，从助记词推导出种子(Seed)

**密钥拉伸函数需要两个参数：助记词和盐。盐可以提高暴力破解的难度。 盐由常量字符串 "mnemonic" 及一个可选的密码组成，注意使用不同密码，则拉伸函数在使用同一个助记词的情况下会产生一个不同的种子** -->

## 测试用例

| 测试用例 |  |
| :----| :---- |
|助记词|soccer want seat goddess phone awake peasant high correct robot believe door|
|密钥|snZeokZMVSEynpKCt7Zvk5pkFZAHt|

## 支持

jcc_wallet开发包中HD钱包当前所支持的链有`ETH类`、`SWTC`、`XRP`、`EOS`、`TRON`
